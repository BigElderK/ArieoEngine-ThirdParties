# Android Dependencies CMake Generator

This Gradle project generates CMake configuration files for Android Game Development Kit dependencies, similar to those automatically generated by Android's Prefab system.

## Project Structure

```
gradle/
├── build.gradle.kts              # Main build configuration (dependencies & platforms)
├── settings.gradle.kts           # Project settings
├── gradle/
│   ├── tasks.gradle.kts          # Utility tasks (copy, list, report)
│   └── cmake-config-generator.gradle.kts  # Main CMake generation logic
├── gradle-wrapper.properties     # Gradle wrapper configuration
└── README.md                     # This file
```

## Configuration

### Dependencies

Edit the `dependencies` section in `build.gradle.kts` to add or remove Android libraries:

```kotlin
dependencies {
    "androidDependencies"("androidx.appcompat:appcompat:1.4.1")
    "androidDependencies"("androidx.games:games-frame-pacing:2.1.3")
    "androidDependencies"("androidx.games:games-performance-tuner:2.0.0")
    "androidDependencies"("androidx.games:games-activity:4.0.0")
    "androidDependencies"("androidx.games:games-controller:2.0.2")
}
```

### Target Platforms

The platform configuration is stored in both files for clarity. To change target platforms:

1. **Main reference** in `build.gradle.kts` (for documentation):
```kotlin
val targetPlatforms = setOf(
    "arm64-v8a"        // 64-bit ARM (most common for modern Android devices)
    // "armeabi-v7a",  // 32-bit ARM  
    // "x86_64",       // 64-bit x86 (emulators)
    // "x86"           // 32-bit x86 (older emulators)
)
```

2. **Active configuration** in `gradle/cmake-config-generator.gradle.kts` (line ~11):
```kotlin
val targetPlatforms = setOf(
    "arm64-v8a"        // Enable/disable platforms here
    // "armeabi-v7a",
    // "x86_64", 
    // "x86"
)
```

**Note:** Keep both configurations in sync. The one in `cmake-config-generator.gradle.kts` is the active configuration that controls which platforms are actually processed.

## How CMake Config Files Work

The `game-activityConfig.cmake` files you see in Android projects are automatically generated by the **Android Gradle Plugin's Prefab feature**. Here's how:

### 1. Android Prefab Process (Automatic)

In an Android project with Prefab enabled:

```kotlin
// build.gradle.kts
android {
    buildFeatures {
        prefab = true  // Enables automatic CMake config generation
    }
}

dependencies {
    implementation("androidx.games:games-activity:4.0.0")
}
```

```cmake
# CMakeLists.txt
find_package(game-activity REQUIRED CONFIG)
target_link_libraries(your_target game-activity::game-activity_static)
```

When you build, Android automatically:
1. Downloads AAR files
2. Extracts native libraries and headers
3. Generates CMake config files in `.cxx/[BuildType]/[ABI]/prefab/`
4. Makes them available via `find_package()`

### 2. Manual Generation (This Project)

This project provides manual generation for when you need CMake configs outside of Android's automatic system.

## Available Tasks

### Generate Dependencies
```bash
./gradlew copyAndroidDependencies     # Download and copy JAR/AAR files
./gradlew listAndroidDependencies     # List all dependencies
./gradlew generateDependencyReport    # Create detailed report
./gradlew generateCMakeConfigs        # Extract AARs and generate CMake config files
```

### Generated CMake Files

The `generateCMakeConfigs` task:

1. **Extracts AAR files** to `build/extracted-aars/`
2. **Finds native libraries** (.a/.so files) and headers
3. **Generates CMake config files** with proper `IMPORTED_LOCATION` and `INTERFACE_INCLUDE_DIRECTORIES`
4. **Creates individual config files**: `[dependency-name]Config.cmake`
5. **Creates master include file**: `AndroidGameDependencies.cmake`

### AAR Extraction Features

- **Multi-platform support**: Generates configs for `android.arm64-v8a`, `android.armeabi-v7a`, `android.x86_64`, `android.x86`
- **Prefab support**: Extracts from `prefab/modules/` structure per architecture
- **Traditional JNI**: Extracts from `jni/` structure per architecture
- **Header detection**: Finds include directories automatically
- **Multi-module AARs**: Creates separate targets for each module (e.g., `game-activity` and `game-activity_static`)
- **Architecture-specific libraries**: Properly maps each ABI to its corresponding native libraries

## Usage in CMake

### Option 1: Include platform-specific master file
```cmake
# In your CMakeLists.txt - choose your target platform
include("/path/to/build/cmake-configs/android.arm64-v8a/AndroidGameDependencies.cmake")    # arm64-v8a
# include("/path/to/build/cmake-configs/android.armeabi-v7a/AndroidGameDependencies.cmake")     # armeabi-v7a  
# include("/path/to/build/cmake-configs/android.x86_64/AndroidGameDependencies.cmake")   # x86_64
# include("/path/to/build/cmake-configs/android.x86/AndroidGameDependencies.cmake")      # x86

# Link all dependencies to your target
target_link_android_game_dependencies(your_target_name)
```

### Option 2: Include individual platform-specific configs
```cmake
# Include specific dependency configs for your target platform
include("/path/to/build/cmake-configs/android.arm64-v8a/appcompatConfig.cmake")
include("/path/to/build/cmake-configs/android.arm64-v8a/games-activityConfig.cmake")

# Use the imported targets
target_link_libraries(your_target
    androidx.appcompat::appcompat
    androidx.games::games-activity
)
```

### Option 3: Dynamic platform selection
```cmake
# Automatically select platform based on Android ABI
if(ANDROID_ABI STREQUAL "arm64-v8a")
    set(ANDROID_PLATFORM "android.arm64-v8a")
elseif(ANDROID_ABI STREQUAL "armeabi-v7a")
    set(ANDROID_PLATFORM "android.armeabi-v7a")
elseif(ANDROID_ABI STREQUAL "x86_64")
    set(ANDROID_PLATFORM "android.x86_64")
elseif(ANDROID_ABI STREQUAL "x86")
    set(ANDROID_PLATFORM "android.x86")
endif()

include("/path/to/build/cmake-configs/${ANDROID_PLATFORM}/AndroidGameDependencies.cmake")
target_link_android_game_dependencies(your_target_name)
```

## Project Structure

```
01_third_parties/gradle/
├── build.gradle.kts              # Main build script with dependency specification
├── settings.gradle.kts            # Project settings
├── gradle/wrapper/                # Gradle wrapper
└── build/
    ├── dependencies/android/      # Downloaded JAR/AAR files
    ├── libs/                      # Organized native libraries and headers
    │   ├── android.arm64-v8a/     # Platform-specific native libs
    │   └── [other platforms]/
    ├── extracted-aars/            # Extracted AAR contents
    ├── cmake-configs/             # Generated CMake configs by platform
    │   ├── android.arm64-v8a/     # CMake configs for specified platform
    │   └── [other platforms]/     # Only generated for specified platforms
    └── reports/                   # Dependency reports
```

## Configuration

### Specify Dependencies
Edit the `dependencies` block in `build.gradle.kts`:
```kotlin
dependencies {
    "androidDependencies"("androidx.games:games-activity:4.0.0")
    "androidDependencies"("androidx.games:games-frame-pacing:2.1.3")
    // Add only the dependencies you need
}
```

### Specify Target Platforms
Edit the `targetPlatforms` variable:
```kotlin
val targetPlatforms = setOf("arm64-v8a", "x86_64") // Only generate for these platforms
```

## Dependencies Included

- `androidx.appcompat:appcompat:1.4.1`
- `androidx.games:games-frame-pacing:2.1.3`
- `androidx.games:games-performance-tuner:2.0.0`
- `androidx.games:games-activity:4.0.0`
- `androidx.games:games-controller:2.0.2`

## Notes

- This manual generation is primarily for JAR files (Java dependencies)
- For native Android libraries with C++ headers, use Android's Prefab system
- The generated CMake configs work best for pure Java dependencies that you want to reference in CMake builds
- For full Android Game Development Kit integration, use the automatic Prefab system in your Android project